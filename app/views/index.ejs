<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tulis Menfess - Homepage</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Plus Jakarta Sans", sans-serif;
      }
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
    </style>
  </head>

  <body class="bg-slate-50 min-h-screen text-slate-800">
    <%- include('partials/navbar') %>

    <div class="max-w-6xl mx-auto px-6 pt-10 pb-6">
      <h2 class="text-2xl font-bold flex items-center gap-2">
        ğŸ“¢ Timeline Terbaru
      </h2>
      <p class="text-slate-500 text-sm">Apa kata anak-anak hari ini?</p>
    </div>

    <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pb-20">
      <% if (typeof messages !== 'undefined' && messages.length > 0) { %>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <% messages.forEach(msg => { 
          const limit = 100;
          const isLong = msg.content.length > limit;
          const displayContent = isLong
            ? msg.content.substring(0, limit) + '...'
            : msg.content;
          const timeStr = new Date(msg.created_at).toLocaleTimeString('id-ID', {
            hour: '2-digit',
            minute: '2-digit'
          });
        %>

        <div
          class="<%= msg.color %> p-6 rounded-2xl border border-black/5 shadow-sm hover:shadow-lg hover:-translate-y-1 transition duration-300 flex flex-col h-full cursor-pointer group"
          onclick="openModal(`<%= msg.sender %>`, `<%= msg.content %>`, `<%= msg.color %>`, `<%= timeStr %>`)"
        >
          <!-- CONTENT -->
          <div class="flex-grow">
            <p class="text-lg font-medium leading-relaxed mb-2 whitespace-pre-wrap">
              "<%= displayContent %>"
            </p>

            <% if (isLong) { %>
              <span class="text-xs font-bold text-slate-500 group-hover:text-indigo-600 underline decoration-dotted">
                Baca Selengkapnya â†—
              </span>
            <% } %>
          </div>

          <!-- LIKE & DISLIKE -->
          <div class="flex justify-end gap-4 mt-3 text-sm">
            <form action="/like/<%= msg.id %>" method="POST">
              <button
                type="submit"
                class="hover:text-green-500 flex items-center gap-1"
                onclick="event.stopPropagation()"
              >
                ğŸ‘ <span><%= msg.likes || 0 %></span>
              </button>
            </form>

            <form action="/dislike/<%= msg.id %>" method="POST">
              <button
                type="submit"
                class="hover:text-red-500 flex items-center gap-1"
                onclick="event.stopPropagation()"
              >
                ğŸ‘ <span><%= msg.dislikes || 0 %></span>
              </button>
            </form>
          </div>

          <!-- FOOTER -->
          <div class="mt-4 pt-4 border-t border-black/5 flex justify-between items-center text-xs text-slate-500">
            <span class="font-bold truncate max-w-[120px]">
              From: <%= msg.sender %>
            </span>
            <span><%= timeStr %></span>
          </div>
        </div>

        <% }) %>
      </div>

      <% } else { %>
        <div class="text-center py-20 bg-white rounded-3xl border border-dashed border-slate-300 max-w-2xl mx-auto">
          <div class="text-5xl mb-4">ğŸ“­</div>
          <p class="text-slate-500 font-medium">
            Sepi banget... Yuk jadi yang pertama curhat!
          </p>
        </div>
      <% } %>
    </main>

    <!-- FLOATING BUTTON -->
    <a
      href="/create"
      class="fixed bottom-8 right-8 bg-indigo-600 text-white p-4 rounded-full shadow-2xl hover:bg-indigo-700 transition transform hover:scale-110 hover:-rotate-6 z-40 group"
    >
      âœï¸
    </a>

    <!-- MODAL -->
    <div id="menfessModal" class="fixed inset-0 z-50 hidden">
      <div
        id="modalBackdrop"
        class="absolute inset-0 bg-black/60 backdrop-blur-sm"
        onclick="closeModal()"
      ></div>

      <div class="relative flex items-center justify-center min-h-screen p-4">
        <div
          id="modalPanel"
          class="bg-white rounded-3xl p-8 max-w-lg w-full shadow-2xl scale-95 opacity-0 transition"
        >
          <div class="flex justify-between mb-4 text-sm text-slate-500">
            <span id="modalSender">From:</span>
            <span id="modalTime">00:00</span>
          </div>

          <p
            id="modalContent"
            class="text-2xl leading-relaxed whitespace-pre-wrap"
          ></p>

          <button
            onclick="closeModal()"
            class="mt-6 w-full bg-black/5 hover:bg-black/10 py-3 rounded-xl font-semibold"
          >
            Tutup
          </button>
        </div>
      </div>
    </div>

    <%- include('partials/footer') %>

    <script>
      const modal = document.getElementById("menfessModal");
      const backdrop = document.getElementById("modalBackdrop");
      const panel = document.getElementById("modalPanel");
      const modalContent = document.getElementById("modalContent");
      const modalSender = document.getElementById("modalSender");
      const modalTime = document.getElementById("modalTime");

      function openModal(sender, content, color, time) {
        modalContent.innerText = content;
        modalSender.innerText = "From: " + sender;
        modalTime.innerText = time;

        panel.className =
          "bg-white rounded-3xl p-8 max-w-lg w-full shadow-2xl transition";

        panel.classList.add(color);

        modal.classList.remove("hidden");
        setTimeout(() => {
          panel.classList.remove("scale-95", "opacity-0");
          panel.classList.add("scale-100", "opacity-100");
        }, 10);
      }

      function closeModal() {
        panel.classList.add("scale-95", "opacity-0");
        setTimeout(() => modal.classList.add("hidden"), 200);
      }
    </script>
  </body>
</html>
